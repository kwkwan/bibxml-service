name: Tests

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

permissions:
  contents: read

jobs:
  build:

    runs-on: ubuntu-latest

    env:
      PORT: 8000
      DB_NAME: indexer
      DB_SECRET: secret
      DJANGO_SECRET: "DJANGOSECRETEHEHEH(****#TEFF"
      HOST: localhost
      API_SECRET: "secret"
      SERVICE_NAME: "IETF BibXML service test"
      CONTACT_EMAIL: "test@gmail.com"
      DEBUG: 1
      SNAPSHOT: "testss"

    steps:
    - uses: actions/checkout@v3
    - name: Build the Docker image
      run: docker compose build
    - name: Run tests
      run: docker compose -f docker-compose.test.yml up
    - name: Stop Containers
      if: always()
      run: docker-compose -f docker-compose.test.yml down
